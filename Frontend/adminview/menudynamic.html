<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paris Sweet Patisserie - Menu</title>
    <link rel="stylesheet" href="../content/menustyles.css">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navigation bar -->
    <nav class="navbar">
        <ul>
            <li><a href="Home.html">Home</a></li>
            <li><a href="menu.html">Menu</a></li>
            <li><a href="dbmenu.html">DBMenu</a></li>
            <li><a href="CakeOrder.html">Custom Cakes</a></li>
            <a href="Home.html"><img src="../photo/logo.jpg" alt="Paris Sweet Patisserie" class="logo"></a>
            <li><a href="event.html">Event</a></li>
            <li><a href="contactus.html">Contact Us</a></li>
            <li><a href="login.html">Log in</a></li>
        </ul>
    </nav>

    <div id="add-product-form-container">
        <h2>Add a New Product</h2>
        <form id="product-form">
            <label for="product_name">Product Name:</label>
            <input type="text" id="product_name" name="product_name" required>

            <label for="product_price">Product Price:</label>
            <input type="number" id="product_price" name="product_price" required step="0.01">

            <label for="product_description">Product Description:</label>
            <textarea id="product_description" name="product_description" required></textarea>

            <label for="product_size">Product Size:</label>
            <input type="text" id="product_size" name="product_size">

            <label for="category_name">Category:</label>
            <input type="text" id="category_name" name="category_name" required>

            <label for="product_image">Product Image URL:</label>
            <input type="text" id="product_image" name="product_image">

            <button type="submit">Add Product</button>
        </form>
    </div>

        
    <!-- Main header -->
    <h1 class="header">Our Delicious Menu</h1>

    <!-- Menu Section -->

    <div id="menu"></div>

    <script>

document.getElementById('product-form').addEventListener('submit', async function(e) {
            e.preventDefault(); // Prevent default form submission

            const formData = new FormData(this);
            const data = {
                product_name: formData.get('product_name'),
                product_price: formData.get('product_price'),
                product_description: formData.get('product_description'),
                product_size: formData.get('product_size'),
                category_name: formData.get('category_name'),
                product_image: formData.get('product_image')
            };

            try {
                // Send the data to the backend
                const response = await fetch('http://localhost:5000/menu/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                
                if (result.success) {
                    alert('Product added successfully!');
                    // Optionally, call fetchMenu() to update the menu on the page
                    fetchMenu();
                } else {
                    alert('Failed to add product: ' + result.message);
                }
            } catch (error) {
                console.error('Error adding product:', error);
                alert('Error adding product');
            }
        });




    

        // Function to fetch menu items from the API
        async function fetchMenu() {
            try {
                // Fetch data from the local server's API
                const response = await fetch('http://localhost:5000/api/get_menu'); // Updated to use local server URL
                const data = await response.json();
    
                if (data.success) {
                // If fetching is successful, call the function to display menu

                    displayMenu(data.menu_items);
                } else {
                    // Show an error if fetching menu fails
                    alert(data.message || 'Failed to fetch menu items');
                }
            } catch (error) {
                // Catch and log any errors that occur during the fetch
                console.error('Error fetching menu:', error);
            }
        }

        // Function to group menu items by their category
        function groupByCategory(menuItems) {
            return menuItems.reduce((categories, item) => {
                const category = item.CategoryName || 'Uncategorized';
                if (!categories[category]) {
                    categories[category] = [];
                }
                categories[category].push(item); // Add item to the correct category
                return categories;
            }, {});
        }

        // Function to display the fetched and grouped menu items
        function displayMenu(menuItems) {
            const groupedItems = groupByCategory(menuItems); // Group items by category
            const menuContainer = document.getElementById('menu');
            menuContainer.innerHTML = ''; // Clear any existing content
            
            // Loop through each category and create the HTML for displaying menu items
            for (const category in groupedItems) {
                const categoryDiv = document.createElement('div');
                categoryDiv.classList.add('menu-container'); // For styling purposes

                //Create and add category title
                const categoryTitle = document.createElement('div');
                categoryTitle.classList.add('category-title');
                categoryTitle.textContent = category;

                categoryDiv.appendChild(categoryTitle);

                // Create individual product divs
                groupedItems[category].forEach(item => {
                    const productDiv = document.createElement('div');
                    productDiv.classList.add('menu-item'); // For styling purposes

                    const productImage = item.ProductImage ? item.ProductImage : "photo/default-image.jpg"; // Use the image URL from DB

                    // Create the HTML for each product and append it to the category div
                    productDiv.innerHTML = `
                        <h3>${item.ProductName}</h3>
                        <img src="${productImage}" alt="${item.ProductName}" class="menu-image"> <!-- Product image -->
                        <p><strong>Description:</strong> ${item.ProductDescription}</p>
                        <p><strong>Price:</strong> $${parseFloat(item.ProductPrice).toFixed(2)}</p>
                        <p><strong>Size:</strong> ${item.ProductSize || 'N/A'}</p>
                    `;
                    categoryDiv.appendChild(productDiv);
                });

                // Append category div to the menu container
                menuContainer.appendChild(categoryDiv);
            }
        }


        // Initialize the page by fetching the menu items
        fetchMenu();


        // Function to display a message to the user
        function showMessage(message) {
            const messageElement = document.getElementById("message");
            messageElement.innerText = message; // Set the message text
            messageElement.style.display = "block";  // Make sure the message is visible

            // Hide the message after 2 seconds (2000ms)
            setTimeout(function() {
                messageElement.style.display = "none";
            }, 2000);  // Adjust this time as needed
        }


        
        
    </script>

</body>
</html>
